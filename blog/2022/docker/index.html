<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content="google-site-verification=6CU-DoIp0FraaNmQsqgvxCw5swk1BHoouEqmFRoeWNc"> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> An introduction to Docker for deep learning researcher | Qiang HE </title> <meta name="author" content="Qiang HE"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%98%8A&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://sweetice.github.io/blog/2022/docker/"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js?0afe9f0ae161375728f7bcc5eb5b4ab4"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Qiang HE </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fa-solid fa-moon"></i> <i class="fa-solid fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">An introduction to Docker for deep learning researcher</h1> <p class="post-meta"> April 20, 2022 </p> <p class="post-tags"> <a href="/blog/2022"> <i class="fa-solid fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/rl"> <i class="fa-solid fa-hashtag fa-sm"></i> RL,</a>   <a href="/blog/tag/programming"> <i class="fa-solid fa-hashtag fa-sm"></i> Programming</a>     ·   <a href="/blog/category/blog"> <i class="fa-solid fa-tag fa-sm"></i> blog</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="docker-极简教程">Docker 极简教程</h1> <font color="red">作者不对文章内容以及文章内容使用不当引发的任何后果负任何责任。请谨慎敲下每一个命令。</font> <p>本文档的目的是帮助深度学习新手一个小时内快速上手docker。</p> <h1 id="预备知识">预备知识</h1> <p>本文档假定读者具有基本的docker知识, 一些Ubuntu操作经验, 基本的git操作基础. 如果你遇到问题,请首先通过搜索引擎尝试寻找解决方案. 后面再求助能够帮助你的人.</p> <p><a href="https://www.runoob.com/git/git-branch.html" rel="external nofollow noopener" target="_blank">git工具的简单使用</a></p> <h1 id="安装">安装</h1> <p>不同平台的安装方式请查看Docker官方文档 (https://docs.docker.com/engine/install/).</p> <p>这里以Ubuntu系统为例子</p> <h2 id="安装docker-文件">安装Docker 文件</h2> <p>首先添加源:</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install</span> <span class="se">\</span>
    apt-transport-https <span class="se">\</span>
    ca-certificates <span class="se">\</span>
    curl <span class="se">\</span>
    gnupg-agent <span class="se">\</span>
    software-properties-common
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -

</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo add-apt-repository \
   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \
   $(lsb_release -cs) \
   stable"
</code></pre></div></div> <p>然后安装docker</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli 
</code></pre></div></div> <p>接下来检测是否正常安装.</p> <p>输入</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker run hello-world
</code></pre></div></div> <p>然后显示</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Unable to find image <span class="s1">'hello-world:latest'</span> locally

latest: Pulling from library/hello-world
2db29710123e: Pull <span class="nb">complete 
</span>Digest: sha256:97a379f4f88575512824f3b352bc03cd75e239179eea0fecc38e597b2209f49a
Status: Downloaded newer image <span class="k">for </span>hello-world:latest

Hello from Docker!
This message shows that your installation appears to be working correctly.

To generate this message, Docker took the following steps:
 1. The Docker client contacted the Docker daemon.
 2. The Docker daemon pulled the <span class="s2">"hello-world"</span> image from the Docker Hub.
    <span class="o">(</span>amd64<span class="o">)</span>
 3. The Docker daemon created a new container from that image which runs the
    executable that produces the output you are currently reading.
 4. The Docker daemon streamed that output to the Docker client, which sent it
    to your terminal.

To try something more ambitious, you can run an Ubuntu container with:
 <span class="nv">$ </span>docker run <span class="nt">-it</span> ubuntu bash

Share images, automate workflows, and more with a free Docker ID:
 https://hub.docker.com/

For more examples and ideas, visit:
 https://docs.docker.com/get-started/
</code></pre></div></div> <h2 id="centos-安装docker">Centos 安装docker</h2> <p><a href="https://www.lmf.life/archives/centos7%E5%AE%89%E8%A3%85nvidia-docker2" rel="external nofollow noopener" target="_blank">参考</a></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /bin/yum update
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /bin/yum install -y yum-utils device-mapper-persistent-data lvm2
</code></pre></div></div> <p>设置源</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum -y install yum-utils
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum list docker-ce --showduplicates | sort -r
</code></pre></div></div> <p>然后选择安装</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>yum install docker-ce
</code></pre></div></div> <p>接下来安装nvidia-docker</p> <p>首先配置</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \
   &amp;&amp; curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.repo | sudo tee /etc/yum.repos.d/nvidia-docker.repo
</code></pre></div></div> <p>更新</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum clean expire-cache
</code></pre></div></div> <p>安装</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo yum install -y nvidia-docker2
</code></pre></div></div> <p>通过测试</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker -v
</code></pre></div></div> <p>centos上的一些小命令</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>df -Th /var/lib/docker
df -h
</code></pre></div></div> <p>第一个命令查看目标目录使用情况</p> <p>第二个命令查看整体情况</p> <h2 id="安装nvidia-docker">安装nvidia docker</h2> <p>为了调用显卡, 我们还需要安装nvidia docker, 请参考<a href="https://docs.nvidia.com/datacenter/cloud-native/container-toolkit/install-guide.html#docker" rel="external nofollow noopener" target="_blank">官方文档</a>进行安装.</p> <p>下面我们以Ubuntu 平台为例.</p> <p>设置docker</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl https://get.docker.com | sh \
  &amp;&amp; sudo systemctl --now enable docker
</code></pre></div></div> <p>设置nvidia 容器工具</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>distribution=$(. /etc/os-release;echo $ID$VERSION_ID) \
   &amp;&amp; curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add - \
   &amp;&amp; curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list
</code></pre></div></div> <p>安装</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update
sudo apt-get install -y nvidia-docker2
</code></pre></div></div> <p>重启</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl restart docker
</code></pre></div></div> <p>然后检查一下是不是可用</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker run --rm --gpus all nvidia/cuda:11.0-base nvidia-smi
</code></pre></div></div> <p>如果显示,</p> <div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Mon Feb 28 01:46:31 2022       
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 470.103.01   Driver Version: 470.103.01   CUDA Version: 11.4     |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|                               |                      |               MIG M. |
|<span class="o">===============================</span>+<span class="o">======================</span>+<span class="o">======================</span>|
|   0  NVIDIA GeForce ...  Off  | 00000000:01:00.0  On |                  N/A |
| 46%   44C    P0    49W / 180W |    803MiB /  8119MiB |      1%      Default |
|                               |                      |                  N/A |
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
| Processes:                                                                  |
|  GPU   GI   CI        PID   Type   Process name                  GPU Memory |
|        ID   ID                                                   Usage      |
|<span class="o">=============================================================================</span>|
+-----------------------------------------------------------------------------+

</code></pre></div></div> <p>那么就搞定了.</p> <h2 id="离线安装docker">离线安装docker</h2> <p>在<a href="https://download.docker.com/linux/static/stable/x86_64/" rel="external nofollow noopener" target="_blank">这里</a>可以下载离线的docker文件.</p> <p>找到存放有<code class="language-plaintext highlighter-rouge">docker-20.10.9.tgz</code>的文件夹. 注意你可能需要sudo权限.</p> <p>首先解压</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>tar -xzvf docker-20.10.9.tgz
</code></pre></div></div> <p>之后进入docker目录, 并且将所有文件拷贝到<code class="language-plaintext highlighter-rouge">/usr/bin/</code>目录下</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd docker/
cp * /usr/bin/
</code></pre></div></div> <p>将如下内容写入<code class="language-plaintext highlighter-rouge">/etc/systemd/system/docker.service</code></p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/systemd/system/docker.service
</code></pre></div></div> <p>然后在弹出来的页面写入</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Unit]
Description=Docker Application Container Engine
Documentation=https://docs.docker.com
After=network-online.target firewalld.service
Wants=network-online.target

[Service]
Type=notify
ExecStart=/usr/bin/dockerd
ExecReload=/bin/kill -s HUP $MAINPID
LimitNOFILE=infinity
LimitNPROC=infinity
TimeoutStartSec=0
Delegate=yes
KillMode=process
Restart=on-failure
StartLimitBurst=3
StartLimitInterval=60s

[Install]
WantedBy=multi-user.target

</code></pre></div></div> <p>给刚才写入的文件增加权限</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chmod +x /etc/systemd/system/docker.service
systemctl daemon-reload 
</code></pre></div></div> <p>设置开启启动docker</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl enable docker.service
</code></pre></div></div> <p>然后启动docker</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl start docker
</code></pre></div></div> <p>然后通过以下方式检查docker是否安装</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker -v
</code></pre></div></div> <p>如果弹出</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Docker version 20.10.9, build c2ea9bc
</code></pre></div></div> <p>那么说明安装成功.</p> <h2 id="离线安装nvidia-docker">离线安装nvidia docker</h2> <p>想在Docker中用GPU资源，就需要安装NVIDIA Container Toolkit，如果工作站能连外网，按照官网的步骤很容易安装，但如果不能连外网，比如只能在校园网IP范围内使用，该如何安装呢？</p> <blockquote> <p>预设条件：已经安装好了显卡驱动和Docker 以下所有下载任务选择最新版；</p> </blockquote> <p>Step 1. 下载<code class="language-plaintext highlighter-rouge">libnvidia-container</code> 安装包（在Ubuntu下是deb文件）</p> <p><a href="https://link.zhihu.com/?target=https%3A//github.com/NVIDIA/libnvidia-container/tree/gh-pages/stable" rel="external nofollow noopener" target="_blank">libnvidia-container/stable at gh-pages · NVIDIA/libnvidia-container (github.com)github.com/NVIDIA/libnvidia-container/tree/gh-pages/stable</a></p> <p>通过VPN传到工作站上，运行</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>dpkg <span class="nt">-i</span> libnvidia-container1_1.4.0-1_amd64.deb
</code></pre></div></div> <p>然后下载安装libnvidia-container-tools</p> <p>https://github.com/NVIDIA/libnvidia-container/tree/gh-pages/stable</p> <p>Step 2. 下载<code class="language-plaintext highlighter-rouge">nvidia-container-toolkit</code> 和 <code class="language-plaintext highlighter-rouge">nvidia-container-runtime</code></p> <p><a href="https://link.zhihu.com/?target=https%3A//github.com/NVIDIA/nvidia-container-runtime/tree/gh-pages/stable" rel="external nofollow noopener" target="_blank">nvidia-container-runtime/stable at gh-pages · NVIDIA/nvidia-container-runtime (github.com)github.com/NVIDIA/nvidia-container-runtime/tree/gh-pages/stable</a></p> <p>以Ubuntu 18.04 为例，分别运行</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo dpkg -i nvidia-container-toolkit_1.5.1-1_amd64.deb
sudo dpkg -i nvidia-container-runtime_3.5.0-1_amd64.deb
</code></pre></div></div> <p>Step 3. 下载<code class="language-plaintext highlighter-rouge">nvidia-docker2</code> 并上传到工作站、安装</p> <p><a href="https://link.zhihu.com/?target=https%3A//github.com/NVIDIA/nvidia-docker/tree/gh-pages" rel="external nofollow noopener" target="_blank">NVIDIA/nvidia-docker at gh-pages (github.com)github.com/NVIDIA/nvidia-docker/tree/gh-pages</a></p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>dpkg <span class="nt">-i</span> nvidia-docker2_2.6.0-1_all.deb
</code></pre></div></div> <p>Step 4. 重启Docker</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>service docker restart
</code></pre></div></div> <h2 id="为非root用户配置docker-使用权限">为非root用户配置docker 使用权限</h2> <ol> <li>使用root用户登录</li> <li>新建用户组docker之前，查看用户组中有没有docker组</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo cat /etc/group | grep docker
</code></pre></div></div> <ol> <li>创建docker分组，并将相应的用户添加到这个分组里面</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo groupadd -g 999 docker 
sudo usermod -aG docker quyuxun
</code></pre></div></div> <ol> <li>检查一下创建是否有效</li> </ol> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cat /etc/group
</code></pre></div></div> <ol> <li> <p>退出当前登录用户，或者重启docker，以让docker用户组生效</p> </li> <li> <p>确认可以使用docker</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>$ docker ps -a
CONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES
</code></pre></div> </div> </li> </ol> <p>如果提示get ……dial unix /var/run/docker.sock权限不够，则修改/var/run/docker.sock权限</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo chmod a+rw /var/run/docker.sock
</code></pre></div></div> <h1 id="配置baseline的docker">配置baseline的docker</h1> <p>baseline 是openai开发的代码库，用来搞强化学习，没有需求的同学可以跳过。</p> <h2 id="baseline的安装">baseline的安装</h2> <p>注意baseline需要有prerequisite</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get update &amp;&amp; sudo apt-get install cmake libopenmpi-dev python3-dev zlib1g-dev
</code></pre></div></div> <p>然后下载baselines</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/openai/baselines.git
cd baselines
</code></pre></div></div> <p>然后安装tensorflow-gpu</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install tensorflow-gpu
</code></pre></div></div> <p>切换到tf2分支(如果愿意,也可以使用tf1), 并且安装</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout tf2
pip install -e .
</code></pre></div></div> <p>然后使用如下代码进行测试</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python -m baselines.run --alg=ppo2 --env=PongNoFrameskip-v4 --num_timesteps=0 --load_path=~/models/pong_20M_ppo2 --play
</code></pre></div></div> <p>这个时候, 你会看到一个gui界面, 那么就成功了.</p> <p><img src="/home/mirror/.config/Typora/typora-user-images/image-20220228112924661.png" alt="image-20220228112924661"></p> <p>然后开始制作docker镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker build -t docker_sample:latest .
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker build -t tl_rl:0.1 .
</code></pre></div></div> <p>这里的 <code class="language-plaintext highlighter-rouge">.</code> 是目录, docker_sample是镜像名字, latest是版本号, 可以用<code class="language-plaintext highlighter-rouge">0.1</code>等标记.</p> <p>然后导出docker镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker save -o docker_image_name.tar docker_sample:latest
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> sudo docker save -o tf_rl.tar tl_rl:0.1
</code></pre></div></div> <p>注意, 导出的镜像可能由于所有者权限问题, 而无法被移动或者复制, 这时候我们需要修改文件权限</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo chmod 777 docker_image_name.tar
</code></pre></div></div> <h1 id="docker-镜像的使用">Docker 镜像的使用</h1> <h2 id="使用压缩好的docker">使用压缩好的docker</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker load -i rl_tf.tar 
sudo docker load --input rl_tf.tar
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>11936051f93b: Loading layer [==================================================&gt;]  129.1MB/129.1MB
...
f63153c62cad: Loading layer [==================================================&gt;]  2.179GB/2.179GB
Loaded image: rl_tf:0.1
</code></pre></div></div> <p>然后我们<code class="language-plaintext highlighter-rouge">sudo docker images</code>可以看到</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>REPOSITORY   TAG       IMAGE ID       CREATED             SIZE
rl_tf        0.1       e5e284047d3f   About an hour ago   3.48GB
</code></pre></div></div> <p>注意, 我们将这个image ID复制下来, 然后</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker run -it --rm e5e284047d3f /bin/bash
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker run --gpus all -it --rm fe7dab327f77 /bin/bash
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python -m baselines.run --alg=ppo2 --env=MountainCar-v0
CUDA_VISIBLE_DEVICES=4 python train.py
</code></pre></div></div> <p>接下来我们就进入了docker 容器了</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@8dc4fac45394:~/code/baselines# 
</code></pre></div></div> <p><a href="https://blog.csdn.net/liujiaping/article/details/121957529" rel="external nofollow noopener" target="_blank">使用带用户的docker命令</a></p> <p>查看uid</p> <p>id</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>uid=1009(quyuxun) gid=1009(quyuxun) groups=1009(quyuxun)
</code></pre></div></div> <p>可以看到此时的uid为1009</p> <p>然后</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -it --user=1009 --gpus=all ed62683294a2 /bin/bash
</code></pre></div></div> <p>显示</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>------------------------------------------
| eplenmean               | 200          |
| eprewmean               | -200         |
| fps                     | 1093         |
| loss/approxkl           | 8.478222e-05 |
| loss/clipfrac           | 0.0          |
| loss/policy_entropy     | 1.0985302    |
| loss/policy_loss        | -0.000300169 |
| loss/value_loss         | 121.43289    |
| misc/explained_variance | -0.000372    |
| misc/nupdates           | 1            |
| misc/serial_timesteps   | 2048         |
| misc/time_elapsed       | 1.87         |
| misc/total_timesteps    | 2048         |
------------------------------------------
</code></pre></div></div> <h2 id="拉取docker-image">拉取Docker image</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker pull davidfitzek/stable-baselines3-gpu:0.4
</code></pre></div></div> <p>然后就开始拉取了</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(baseline) mirror@mirror:~/Documents/code/Baseline_Docker/baselines/baselines$ sudo docker pull davidfitzek/stable-baselines3-gpu:0.4
0.4: Pulling from davidfitzek/stable-baselines3-gpu
...
Digest: sha256:5b3f1606b747b1ea9dabc23b8c4970e5141845e89b9df9a4ea9f013128e1bcdf
Status: Downloaded newer image for davidfitzek/stable-baselines3-gpu:0.4
docker.io/davidfitzek/stable-baselines3-gpu:0.4
</code></pre></div></div> <p>然后开始运行docker</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker run -it --rm davidfitzek/stable-baselines3-gpu:0.4
</code></pre></div></div> <p>使用如下脚本测试</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">stable_baselines3</span> <span class="kn">import</span> <span class="n">PPO</span>

<span class="n">model</span> <span class="o">=</span> <span class="nc">PPO</span><span class="p">(</span><span class="sh">'</span><span class="s">MlpPolicy</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">CartPole-v1</span><span class="sh">'</span><span class="p">).</span><span class="nf">learn</span><span class="p">(</span><span class="mi">10000</span><span class="p">)</span>
</code></pre></div></div> <h2 id="安装rom">安装ROM</h2> <p>为了让你的电脑能够运行atari游戏,你需要安装atari的rom</p> <p>进入: https://github.com/openai/atari-py#roms</p> <p>然后解压到一个位置, 接下来安装</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python -m atari_py.import_roms &lt;path to folder&gt;
</code></pre></div></div> <p>注意, 安装之后就不要移动rom的位置了, 否则会造成运行出问题.</p> <p>如果这个脚本无法成功运行, 也可以将文件手动拷贝到你的atari_roms目录下</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/anaconda3/envs/baseline/lib/python3.6/site-packages/atari_py/atari_roms
</code></pre></div></div> <h3 id="使用ale环境安装atari">使用ALE环境安装atari</h3> <p>如果你无法使用atari-py安装rom, 那么请你使用ALE环境</p> <p>https://github.com/mgbellemare/Arcade-Learning-Environment</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install ale-py
ale-import-roms roms/
</code></pre></div></div> <h2 id="将anaconda环境迁移到docker中">将anaconda环境迁移到docker中</h2> <p><a href="https://blog.csdn.net/qq_43787006/article/details/114368252" rel="external nofollow noopener" target="_blank">此处参考</a></p> <p>首先搜索anaconda镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker search anaconda
</code></pre></div></div> <p>然后拉取镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker pull anaconda
</code></pre></div></div> <p>然后运行镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker run -i -t continuumio/anaconda3 /bin/bash
sudo docker run --gpus all -it --rm continuumio/anaconda3 /bin/bash

# sudo docker run -i -t continuumio/anaconda3 /bin/bash 909fa31992e8
# sudo docker run --gpus all nvidia/cuda:10.1 curl
</code></pre></div></div> <p>docker环境下，查找anaconda路径</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whereis anaconda
</code></pre></div></div> <p>本地环境下 复制本地环境到docker</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker cp your_path/anaconda3/envs/env_name docker_name:anaconda_path/envs
# sudo docker cp /home/mirror/anaconda3/envs/rprl 909fa31992e8:.
</code></pre></div></div> <p>这里要注意，首先我们要选择dockerID进行复制，这个ID通过<code class="language-plaintext highlighter-rouge">docker ps -a</code>查看，然后选择对应的ID。</p> <p>之后我们使用</p> <p>将docker容器保存为镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker commit -a [author] -m [instruction] docker_name image_name
sudo docker commit -a heqiang -m 909fa31992e8 curl

$ sudo docker commit -m "Add curl code" -a "heqiang" 4ece334a2d32 curl:latest
4f177bd27a9ff0f6dc2a830403925b5360bfe0b93d476f7fc3231110e7f71b1c
</code></pre></div></div> <p>其中，-m 来指定提交的说明信息，跟我们使用的版本控制工具一样；-a 可以指定更新的用户信息；之后是用来创建镜像的容器的 ID；最后指定目标镜像的仓库名和 tag 信息。创建成功后会返回这个镜像的 ID 信息。</p> <p>查看新镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker image ls
</code></pre></div></div> <p>将镜像保存为压缩包</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker save image_name -o compressed_package_name.tar
</code></pre></div></div> <p>docker镜像导入 在新的机器上导入之前创建的docekr环境。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker load -i compressed_package_name
</code></pre></div></div> <p>启动docker镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -i -t docker_image_name /bin/bash
</code></pre></div></div> <h1 id="docker-数据存储">Docker 数据存储</h1> <p><a href="https://blog.51cto.com/u_15358844/3792845" rel="external nofollow noopener" target="_blank">参考文章</a></p> <h2 id="什么是数据卷">什么是数据卷</h2> <p>​ 我们都知道在Docker中，容器的数据读写默认发生在容器的存储层，当容器被删除时其上的数据将会丢失。如果想实现数据的持久化，就需要将容器和宿主机建立联系（将数据从宿主机挂载到容器内），通俗的说，数据卷就是在容器和宿主机之间实现数据共享。</p> <h2 id="docker支持的三种数据挂载方式">Docker支持的三种数据挂载方式</h2> <p>Docker提供了三种不同的方式将数据从宿主机挂载到容器中：volume、bind mounts、tmpfs mounts</p> <p>volume：Docker管理宿主机文件系统的一部分（/var/lib/docker/volumes）</p> <p>bind mounts：可以存储在宿主机系统的任意位置</p> <h2 id="使用绑定数据卷存储数据">使用绑定数据卷存储数据</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker run -it --mount type=bind,source=/opt,target=/root/code/curl/curl_data/ curl /bin/bash
</code></pre></div></div> <p>这样就完成了目录的映射，然后将数据存储在对应的目录上就好了，即使是退出docker，也能保存docker产生的数据。</p> <h2 id="tmpfs-mounts挂载存储在宿主机系统的内存中不会写入宿主机的文件系统">tmpfs mounts：挂载存储在宿主机系统的内存中，不会写入宿主机的文件系统</h2> <p>©著作权归作者所有：来自51CTO博客作者qq6136ff484095f的原创作品，请联系作者获取转载授权，否则将追究法律责任 Docker数据存储方式：数据卷（Data Volume） https://blog.51cto.com/u_15358844/3792845</p> <h1 id="使用技巧">使用技巧</h1> <h2 id="30系显卡的使用">30系显卡的使用</h2> <p>30系的显卡，需要对的cuda 的torch版本</p> <p>使用这种方法来安装torch版本就好了，这个请在Dockerfile里完成。</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/cu113
</code></pre></div></div> <h2 id="基本技巧">基本技巧</h2> <p>如下是常用docker 命令.</p> <p>制作docker</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker build -t popro:latest .
</code></pre></div></div> <p>制作docker文件</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker save image_name -o compressed_package_name
</code></pre></div></div> <p>删除容器</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker <span class="nb">rm </span>CONTAINER_ID
</code></pre></div></div> <p>列出所有容器（包括正在运行的和已经退出的容器）</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ps -a
</code></pre></div></div> <p>停止正在运行的容器</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker stop CONTAINER_ID
</code></pre></div></div> <p>删除镜像（删除镜像之前需要删除所有该镜像下的容器）</p> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker rmi IMAGE_ID
</code></pre></div></div> <p>重命名</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker tag 0d5b39aeafc2 rprl:1.0
</code></pre></div></div> <p>导出docker镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker save -o docker_image_name.tar docker_sample:latest
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo docker save -o tf_rl.tar tl_rl:0.1
</code></pre></div></div> <p>注意, 导出的镜像可能由于所有者权限问题, 而无法被移动或者复制, 这时候我们需要修改文件权限</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo chmod 777 docker_image_name.tar
</code></pre></div></div> <p>将docker容器保存为镜像</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker commit -a [author] -m [instruction] docker_name image_name
sudo docker commit -a heqiang -m 909fa31992e8 curl

$ sudo docker commit -m "Add curl code" -a "heqiang" 4ece334a2d32 curl:latest
4f177bd27a9ff0f6dc2a830403925b5360bfe0b93d476f7fc3231110e7f71b1c
</code></pre></div></div> <p>其中，-m 来指定提交的说明信息，跟我们使用的版本控制工具一样；-a 可以指定更新的用户信息；之后是用来创建镜像的容器的 ID；最后指定目标镜像的仓库名和 tag 信息。创建成功后会返回这个镜像的 ID 信息。</p> <p>查看新镜像</p> <p>docker run启动一个docker之后，就会生成一个容器，然后这个容器就会一直存在系统里，因此不用再使用docker run启动新的容器了。</p> <p>所以目前再找到之前保存的docker logs，然后找到ID，启动就好了</p> <p>寻找docker ID</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker ps -a
</code></pre></div></div> <p>寻找该docker 下发生了啥</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker logs docker_Id	
</code></pre></div></div> <p>然后启动该docker</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker start docker_id
</code></pre></div></div> <p>之后再attach上docker就好了</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker attach docker_name
</code></pre></div></div> <p>清理整个docker 系统</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>docker system prune
</code></pre></div></div> <h2 id="写dockerfile的时候">写dockerfile的时候</h2> <p>FROM不需要注明版本号，例如</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM continuumio/anaconda3
</code></pre></div></div> <p>记得要写-y</p> <h2 id="docker-layer的逻辑">docker layer的逻辑</h2> <p>docker 会对每一次run，都生成一次layer，所以我们可以将一堆shell脚本，打包在一起，例如 <code class="language-plaintext highlighter-rouge">docker.sh</code></p> <p>然后，我们输入如下语句，就可以了</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>COPY docker.sh .
RUN chmod +x docker.sh
RUN ./docker.sh
</code></pre></div></div> <h2 id="普通用户使用docker">普通用户使用docker</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo groupadd docker
sudo gpasswd -a ${USER} docker
sudo systemctl restart docker
</code></pre></div></div> <h1 id="bug-排除">BUG 排除</h1> <p>这里提供一些bug的排除机制</p> <h2 id="importerror-cannot-import-name-flattendictwrapper">ImportError: cannot import name ‘FlattenDictWrapper’</h2> <p>这是由于<a href="https://github.com/openai/baselines/issues/1129" rel="external nofollow noopener" target="_blank">gym环境的支持问题</a>, 使用baseline的tf2分支, 请使用gym==0.14</p> <p>解决:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip install gym==0.14
</code></pre></div></div> <h2 id="error-response-from-daemon-could-not-select-device-driver--with-capabilities-gpu">Error response from daemon: could not select device driver ““ with capabilities: [[gpu]]</h2> <p>安装nvidia-docker就可以解决。<a href="https://blog.csdn.net/dou3516/article/details/108314908" rel="external nofollow noopener" target="_blank">见</a></p> <p><a href="https://zhuanlan.zhihu.com/p/397638816" rel="external nofollow noopener" target="_blank">安装的方法</a></p> <h2 id="终端设置代理">终端设置代理</h2> <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export http_proxy=http://127.0.0.1:12333
</code></pre></div></div> <h2 id="mujoco-distutilserrorscompileerror-command-gcc-failed-with-exit-status-1">MuJoCo: distutils.errors.CompileError: command ‘gcc’ failed with exit status 1</h2> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install libosmesa6-dev libgl1-mesa-glx libglfw3
sudo apt-get install patchelf
</code></pre></div></div> <p>sudo apt install libosmesa6-dev</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/NVIDIA_SMI/">Fix NVIDIA-SMI has failed because it couldn't communicate with the NVIDIA driver</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/functional_gradient_descent/">Functional Gradient Descent</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/How_to_install_mpi4py_in_your_ubuntu/">How to installation mpi4py in your ubuntu</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/Config_static_ipv6/">Common skills of ubuntu</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2019/How_to_plot_figures_like_RL_papers/">How to plot performance figures in reinforcement learning papers</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Qiang HE. Last updated: May 23, 2024. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega@5.27.0/build/vega.min.js" integrity="sha256-Yot/cfgMMMpFwkp/5azR20Tfkt24PFqQ6IQS+80HIZs=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega-lite@5.16.3/build/vega-lite.min.js" integrity="sha256-TvBvIS5jUN4BSy009usRjNzjI1qRrHPYv7xVLJyjUyw=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/vega-embed@6.24.0/build/vega-embed.min.js" integrity="sha256-FPCJ9JYCC9AZSpvC/t/wHBX7ybueZhIqOMjpWqfl3DU=" crossorigin="anonymous"></script> <script>let theme=localStorage.getItem("theme");document.onreadystatechange=(()=>{"complete"===document.readyState&&document.querySelectorAll("pre>code.language-vega_lite").forEach(e=>{const t=e.textContent,a=e.parentElement;a.classList.add("unloaded");let d=document.createElement("div");d.classList.add("vega-lite"),a.after(d),"dark"===theme?vegaEmbed(d,JSON.parse(t),{theme:"dark"}):vegaEmbed(d,JSON.parse(t))})});</script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2930004b8d7fcd0a8e00fdcfc8fc9f24"></script> <script defer src="/assets/js/common.js?4a129fbf39254905f505c7246e641eaf"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script async src="https://www.googletagmanager.com/gtag/js?id=G-VRTHF8HTJD"></script> <script>function gtag(){window.dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-VRTHF8HTJD");</script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>